{% extends "base.html" %}
{% block content %}

<div class="flex items-center justify-between mb-6">
  <div>
    <h2 class="text-2xl font-semibold text-gray-900">Booking Details</h2>
    <p class="text-gray-600 text-sm mt-1">Complete overview: status, stages, payment, staff.</p>
  </div>
  <a href="{{ url_for('home') }}" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm">
    Back
  </a>
</div>

<!-- Booking Summary -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div class="lg:col-span-2 bg-white border border-gray-200 rounded-xl shadow-sm p-6">
    <div class="flex items-start justify-between">
      <div>
        <h3 class="text-lg font-semibold text-gray-900">Booking #{{ booking[0] }}</h3>
        <p class="text-sm text-gray-600 mt-1">Customer: {{ booking[5] }} â€¢ Vehicle: {{ booking[6] }}</p>
      </div>
      <span class="px-3 py-1 rounded-full text-xs
        {% if booking[3]=='Completed' %} bg-green-100 text-green-800
        {% elif booking[3]=='InProgress' %} bg-blue-100 text-blue-800
        {% elif booking[3]=='Booked' %} bg-yellow-100 text-yellow-800
        {% else %} bg-red-100 text-red-800 {% endif %}">
        {{ booking[3] }}
      </span>
    </div>

    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div class="p-4 border border-gray-200 rounded-lg">
        <div class="text-xs text-gray-500">Package</div>
        <div class="text-sm text-gray-900 font-medium">{{ booking[7] }} (Rs {{ booking[8] }})</div>
      </div>
      <div class="p-4 border border-gray-200 rounded-lg">
        <div class="text-xs text-gray-500">Current Stage</div>
        <div class="text-sm text-gray-900 font-medium">{{ booking[9] or '-' }}</div>
      </div>
      <div class="p-4 border border-gray-200 rounded-lg">
        <div class="text-xs text-gray-500">Booking Time</div>
        <div class="text-sm text-gray-900 font-medium">{{ booking[1] }}</div>
      </div>
      <div class="p-4 border border-gray-200 rounded-lg">
        <div class="text-xs text-gray-500">Scheduled</div>
        <div class="text-sm text-gray-900 font-medium">{{ booking[2] or '-' }}</div>
      </div>
    </div>

    <div class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
      <div class="text-xs text-gray-500">Notes</div>
      <div class="text-sm text-gray-800">{{ booking[4] or "â€”" }}</div>
    </div>
  </div>

  <!-- Payment -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-900">Payment</h3>
    {% if payment %}
      <div class="mt-4 space-y-3">
        <div class="p-4 border border-gray-200 rounded-lg">
          <div class="text-xs text-gray-500">Amount</div>
          <div class="text-sm text-gray-900 font-semibold">Rs {{ payment[0] }}</div>
        </div>
        <div class="p-4 border border-gray-200 rounded-lg">
          <div class="text-xs text-gray-500">Method</div>
          <div class="text-sm text-gray-900 font-medium">{{ payment[1] }}</div>
        </div>
        <div class="p-4 border border-gray-200 rounded-lg">
          <div class="text-xs text-gray-500">Status</div>
          <div class="text-sm text-gray-900 font-medium">{{ payment[2] }}</div>
        </div>
        <div class="p-4 border border-gray-200 rounded-lg">
          <div class="text-xs text-gray-500">Paid At</div>
          <div class="text-sm text-gray-900 font-medium">{{ payment[3] or '-' }}</div>
        </div>
      </div>
    {% else %}
      <div class="mt-4 text-sm text-gray-600">No payment record found.</div>
    {% endif %}
  </div>
</div>

<!-- Assigned Staff + Timeline + History -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
  <!-- Assigned Staff -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-900">Assigned Staff</h3>
    <div class="mt-4 space-y-2">
      {% if assigned %}
        {% for a in assigned %}
          <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
            <div>
              <div class="text-sm text-gray-900 font-medium">{{ a[0] }}</div>
              <div class="text-xs text-gray-500">{{ a[1] }} â€¢ {{ a[2] }}</div>
            </div>
            <div class="text-gray-400">ðŸ‘¤</div>
          </div>
        {% endfor %}
      {% else %}
        <div class="text-sm text-gray-600">No staff assigned yet.</div>
      {% endif %}
    </div>
  </div>

  <!-- Simple Timeline (visual) -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6 lg:col-span-2">
    <h3 class="text-lg font-semibold text-gray-900">Service Progress</h3>
    <p class="text-sm text-gray-600 mt-1">Live stage tracking overview.</p>

    <div class="mt-6 space-y-4">
      {% set stages = ["Washing","Drying","Polishing","Completed"] %}
      {% for s in stages %}
        {% set is_current = (booking[9] == s) %}
        {% set is_done = (booking[9] == "Completed") or (s == "Washing" and booking[9] in ["Drying","Polishing","Completed"])
                          or (s == "Drying" and booking[9] in ["Polishing","Completed"])
                          or (s == "Polishing" and booking[9] in ["Completed"]) %}
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 rounded-full
            {% if is_current %} bg-blue-600
            {% elif is_done %} bg-green-600
            {% else %} bg-gray-300 {% endif %}">
          </div>
          <div class="flex-1 p-3 border rounded-lg
            {% if is_current %} border-blue-200 bg-blue-50
            {% elif is_done %} border-green-200 bg-green-50
            {% else %} border-gray-200 bg-white {% endif %}">
            <div class="text-sm font-medium text-gray-900">{{ s }}</div>
            <div class="text-xs text-gray-600">
              {% if is_current %}Current stage{% elif is_done %}Completed{% else %}Pending{% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="mt-6">
      <h4 class="text-sm font-semibold text-gray-900 mb-2">Stage History</h4>
      <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
        {% if history %}
          <ul class="space-y-2">
            {% for h in history %}
              <li class="text-sm text-gray-800">
                <span class="font-medium">{{ h[0] }}</span>
                <span class="text-gray-500"> | start:</span> {{ h[1] }}
                <span class="text-gray-500"> | end:</span> {{ h[2] or '-' }}
                <span class="text-gray-500"> | by:</span> {{ h[3] }}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-sm text-gray-600">No history yet.</div>
        {% endif %}
      </div>
    </div>

  </div>
</div>

{% endblock %}
